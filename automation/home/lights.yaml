- alias: Lights on when home
  trigger:
    - platform: numeric_state
      entity_id: sensor.living_room_motion_sensor_luminance
      below: 40
      for:
        minutes: 10
    - platform: state
      entity_id: group.household
      from: 'not_home'
      to: 'home'
    - platform: state
      entity_id: input_boolean.everyone_asleep
      to: 'off'
  condition:
    - condition: state
      entity_id: input_boolean.everyone_asleep
      state: 'off'
    - condition: state
      entity_id: group.household
      state: 'home'
    - condition: time
      after: '07:00:00'
      before: '23:00:00'
    - condition: numeric_state
      entity_id: sensor.living_room_motion_sensor_luminance
      below: 40
    - condition: state
      entity_id: input_boolean.light_mode
      state: 'on'
  action:
    - service: input_boolean.turn_on
      entity_id: input_boolean.light_interior

- alias: Lights off when away
  trigger:
    - platform: state
      entity_id: group.household
      from: 'home'
      to: 'not_home'
  condition:
    - condition: state
      entity_id: input_boolean.light_mode
      state: 'on'
    - condition: state
      entity_id: input_boolean.guest_mode
      state: 'off'
  action:
    - service: input_boolean.turn_off
      entity_id: input_boolean.light_interior

- alias: Lights off when bright
  trigger:
    - platform: numeric_state
      entity_id: sensor.living_room_motion_sensor_luminance
      above: 40
      for:
        minutes: 10
  condition:
    - condition: time
      after: '06:00:00'
      before: '23:00:00'
    - condition: state
      entity_id: input_boolean.light_mode
      state: 'on'
  action:
    - service: input_boolean.turn_off
      entity_id: input_boolean.light_interior

- alias: Lights off when away
  trigger:
    - platform: state
      entity_id: group.household
      to: 'not_home'
  condition:
    - condition: state
      entity_id: input_boolean.guest_mode
      state: 'off'
    - condition: state
      entity_id: input_boolean.light_mode
      state: 'on'
  action:
    - service: input_boolean.turn_off
      entity_id: input_boolean.light_interior

- alias: Lights on when arriving late
  trigger:
    - platform: state
      entity_id: device_tracker.johnnysiphone
      from: 'not_home'
      to: 'home'
    - platform: state
      entity_id: device_tracker.kajsasiphone
      from: 'not_home'
      to: 'home'
  condition:
    - condition: and
      conditions:
        - condition: time
          after: '23:00:00'
          before: '06:00:00'
        - condition: state
          entity_id: group.household
          state: 'home'
    - condition: state
      entity_id: input_boolean.light_mode
      state: 'on'
  action:
    service: homeassistant.turn_on
    entity_id: light.dining_room_lamp

- alias: Lights dimmed when last person goes to bed
  trigger:
    - platform: state
      entity_id: input_boolean.everyone_asleep
      to: 'on'
  condition:
    - condition: state
      entity_id: light.bedroom_lamp
      state: 'on'
    - condition: state
      entity_id: input_boolean.light_mode
      state: 'on'
  action:
    - service: scene.turn_on
      entity_id: scene.lights_cozy

- alias: Lights off when last person goes to bed after one minute
  trigger:
    - platform: state
      entity_id: input_boolean.everyone_asleep
      to: 'on'
      for:
        minutes: 1
  condition:
    - condition: state
      entity_id: light.bedroom_lamp
      state: 'on'
    - condition: state
      entity_id: input_boolean.light_mode
      state: 'on'
  action:
    - service: input_boolean.turn_off
      entity_id: input_boolean.light_interior

- alias: Lights on when on vacation
  trigger:
    - platform: sun
      event: sunset
    - platform: time
      at: '18:00:00'
  condition:
    - condition: state
      entity_id: input_boolean.vacation_mode
      state: 'on'
    - condition: state
      entity_id: input_boolean.light_mode
      state: 'on'
    - condition: state
      entity_id: input_boolean.guest_mode
      state: 'off'
  action:
    - service: scene.turn_on
      entity_id: scene.lights_vacation

- alias: Lights off when on vacation
  trigger:
    - platform: time
      at: '22:30:00'
  condition:
    - condition: state
      entity_id: input_boolean.vacation_mode
      state: 'on'
    - condition: state
      entity_id: input_boolean.light_mode
      state: 'on'
    - condition: state
      entity_id: input_boolean.guest_mode
      state: 'off'
  action:
    - service: scene.turn_on
      entity_id: scene.lights_off

- alias: Lights to cozy after 10pm if on
  trigger:
    - platform: time
      at: '22:00:00'
  condition:
    - condition: state
      entity_id: group.interior_lights
      state: 'on'
    - condition: state
      entity_id: binary_sensor.workday_sensor
      state: 'on'
    - condition: state
      entity_id: input_boolean.vacation_mode
      state: 'off'
    - condition: state
      entity_id: input_boolean.light_mode
      state: 'on'
    - condition: state
      entity_id: input_boolean.guest_mode
      state: 'off'
  action:
    service: scene.turn_on
    entity_id: scene.lights_cozy
